$(function(){function t(){$.ajax({url:"./../php/questionSolve.php",type:"post",dataType:"json",data:{qId:i},success:function(t){var a=t[0][0],s=t[1];if($(".ask-solve-title").html(a.quesTitle),$(".ask-solve-content").html(a.quesContent),$(".ask-user-name").html(a.username),$(".title-number").html(a.askNumber),0==s.length)$(".solve-items-content").hide(),$(".no-comment").html("还没有评论，来抢个沙发吧~");else for(var n in s)$(".items-content-box").append("<div class='solve-items-content'><div class='items-content-img'><img src='../src/assets/img/user/"+s[n].userImg+"' alt=''></div><p class='items-username'>"+s[n].username+"</p><div class='items-content'>"+s[n].answer+"</div><p class='items-view clearfix' id='btn-"+n+"'><span class='list-btn'><button class='btn-reply' data-name='"+s[n].username+"'data-id='"+s[n].answerId+"'>回复</button></span></p></div>"),e(s[n].answerId,n)}})}function e(t,e){$.ajax({url:"./../php/ask-comment.php",type:"post",dataType:"json",data:{answerId:t},success:function(a){var s,n=a[0];for(s in n)$("#btn-"+e).after("<div class='list-reply'><img src='./../src/assets/img/user/"+n[s].cimg+"' alt=''><p class='list-name'>"+n[s].cuser+" 回复 "+n[s].taruser+"</p><p class='list-content'>"+n[s].comment+"</p><p class='list-btn-reply'><button class='btn-reply' data-name='"+n[s].cuser+"'data-id='"+t+"'>回复</button></p></div>")}})}function a(t){var e,a=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(a))?unescape(e[2]):null}function s(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(e);return null!=a?unescape(a[2]):null}function n(){null==o?$(".imooc-login-box,.imooc-login-mask").fadeIn():window.location.href="./../web/page-ask-questions.html"}var i=s("id"),o=a("username");$(".items-content-box").on("click",".btn-reply",function(){$(".addc-text").remove();var t=$(this).data("name"),e=$(this).data("id");$(this).parent().after("<div class='addc-text'><textarea rows='5' class='add-comment'></textarea><input type='hidden' value='"+t+"' class='tarUser'><input type='hidden' value='"+o+"' class='uname'><input type='hidden' value='"+e+"' class='aid'><input type='submit' value='提交' class='add-text-btn'></div>")}),$(".items-content-box").on("click",".add-text-btn",function(){var t=$(".add-comment").val(),e=$(".tarUser").val(),a=$(".uname").val(),s=$(".aid").val();null==o?$(".imooc-login-box,.imooc-login-mask").fadeIn():$.ajax({url:"./../php/addReply.php",type:"post",data:{type:"ask",comment:t,tarUser:e,uname:a,aid:s},dataType:"json",success:function(t){"success"==t?location.reload():alert("很抱歉，提交失败~")}})}),t(),$(".my-ask").on("click",function(){var t=editor.html();""==t?$(".prompt-content").css("visibility","initial"):null==o?$(".imooc-login-box,.imooc-login-mask").fadeIn():$.ajax({url:"./../php/addAnswer.php",type:"post",data:{content:t,qId:i,username:o},success:function(t){"success"==t?($(".my-ask").before("<div class='alert-box'>提交成功</div>"),setTimeout(function(){$(".alert-box").remove()},1e3),setTimeout("location.reload()",1e3)):alert("提交失败")}})}),$(".title-btn-ask").on("click",function(){n()})});