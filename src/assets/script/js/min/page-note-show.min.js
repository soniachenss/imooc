$(function(){function t(t){var a=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),e=window.location.search.substr(1).match(a);return null!=e?unescape(e[2]):null}function a(t,a){$.ajax({url:"./../php/note-comment.php",type:"post",dataType:"json",data:{addId:t},success:function(e){var n,s=e[0];for(n in s)$("#btn-"+a).after("<div class='list-reply'><img src='./../src/assets/img/user/"+s[n].cimg+"' alt=''><p class='list-name'>"+s[n].cuser+" 回复 "+s[n].taruser+"</p><p class='list-content'>"+s[n].comment+"</p><p class='list-btn-reply'><button class='btn-reply' data-name='"+s[n].cuser+"'data-id='"+t+"'>回复</button></p></div>")}})}function e(t){var a,e=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(a=document.cookie.match(e))?unescape(a[2]):null}var n=t("nid"),s=e("username");$(".note-content-discuss").on("click",".btn-reply",function(){$(".addc-text").remove();var t=$(this).data("name"),a=$(this).data("id");$(this).parent().after("<div class='addc-text'><textarea rows='5' class='add-comment'></textarea><input type='hidden' value='"+t+"' class='tarUser'><input type='hidden' value='"+s+"' class='uname'><input type='hidden' value='"+a+"' class='aid'><input type='submit' value='提交' class='add-text-btn'></div>")}),$(".note-content-discuss").on("click",".add-text-btn",function(){var t=$(".add-comment").val(),a=$(".tarUser").val(),e=$(".uname").val(),n=$(".aid").val();$.ajax({url:"./../php/addReply.php",type:"post",data:{type:"note",comment:t,tarUser:a,uname:e,aid:n},dataType:"json",success:function(t){"success"==t?location.reload():alert("很抱歉，提交失败~")}})}),$(".write-review").on("click",function(){var t=editor.html();null==s?$(".imooc-login-box,.imooc-login-mask").fadeIn():$.ajax({url:"./../php/addComment.php",type:"post",dataType:"json",data:{content:t,noteId:n,uname:s},success:function(t){"success"==t&&($("body").append("<div class='alert-box'>提交成功！</div>"),setTimeout(function(){$(".alert-box").remove(),location.reload()},2e3))}})}),$.ajax({url:"./../php/note-show.php",type:"post",dataType:"json",data:{noteId:n},success:function(t){var e=t[0],n=t[1];$(".note-content-title").html(e.noteTitle),$(".note-content-main").html(e.noteContent),$(".tab-view").html(e.view),$(".tab-author").html(e.username),$(".tab-add").html(t[2]);for(var s=0;s<t[2];s++)$(".discuss-write").after("<div class='discuss-list'><img src='./../src/assets/img/user/"+n[s].userImg+"' alt=''><p class='list-name'>"+n[s].username+"</p><p class='list-content'>"+n[s].addContent+"</p><p class='list-btn' id='btn-"+s+"'><button class='btn-reply' data-name='"+n[s].username+"'data-id='"+n[s].addId+"'>回复</button></p></div>"),a(n[s].addId,s)}})});