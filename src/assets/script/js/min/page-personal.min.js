$(function(){function e(e){var s,a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(s=document.cookie.match(a))?unescape(s[2]):null}function s(e){var s=null;return void 0!=window.createObjectURL?s=window.createObjectURL(e):void 0!=window.URL?s=window.URL.createObjectURL(e):void 0!=window.webkitURL&&(s=window.webkitURL.createObjectURL(e)),s}function a(){var e=new FormData($("#msg-modify-form")[0]);return $.ajax({url:"./../php/messageUpdate.php",type:"POST",data:e,dataType:"json",async:!1,cache:!1,processData:!1,contentType:!1}).done(function(e){e.isSuccess?(n("username",e.name),n("userImg",e.userImg)):alert("提交失敗")}),!1}function n(e,s){var a=30,n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3),document.cookie=e+"="+escape(s)+";expires="+n.toGMTString()}$(".login-text a").attr("href","javascript:void(0);");var t=e("username");$(".left-username").html(t),$(".old-name").val(t),$(".input-name").blur(function(){var e=/\w{3,12}/,s=$(this).val();""!=s&&e.test(s)?$(".error-remind").html(""):$(".error-remind").html("*请输入3-12位中英文、数字、下划线组成的用户名")}).focus(function(){$(".error-remind-username").html("")}),$(".old-pass").blur(function(){var e=$(this).val();""==e?$(".remind-o").html("*请输入6-16位密码"):$(".remind-o").html("")}).focus(function(){$(".remind-o").html("")}),$(".new-pass").blur(function(){var e=/^[^\s]{6,16}$/,s=$(this).val();""!=s&&e.test(s)?$(".remind-p").html(""):$(".remind-p").html("*请输入6-16位密码，区分大小写，不能使用空格！")}).focus(function(){$(".remind-p").html("")}),$(".re-pass").blur(function(){var e=$(".new-pass").val(),s=$(this).val();e!=s?$(".remind-rp").html("*密码不一致，请确认"):$(".remind-rp").html("")}).focus(function(){$(".remind-rp").html("")}),$("#fileimg").change(function(){var e=s(this.files[0]);e&&$("#img").attr("src",e)}),$(".msg-modify").on("click",function(){var e=/\w{3,12}/,s=$(".input-name").val();return(""!=s||!e.test(s))&&void a()}),$(".pass-btn button").on("click",function(){var e=$(".old-pass").val(),s=$(".new-pass").val(),a=$(".re-pass").val();return""!=e&&""!=s&&""!=a&&(s==a&&void $.ajax({url:"./../php/passwordDeal.php",type:"post",data:{name:t,oldp:e,newp:s,renewp:a},dataType:"json",success:function(e){e.isSuccess?($("body").append("<div class='alert-box'>提交成功！</div>"),setTimeout(function(){$(".alert-box").remove(),location.reload()},2e3)):("passerror"==e.error?$("body").append("<div class='alert-box'>原密码错误，请重新填写</div>"):"notnullerror"==e.error?$("body").append("<div class='alert-box'>密码不能为空，提交失败！</div>"):$("body").append("<div class='alert-box'>密码重置失败！</div>"),setTimeout(function(){$(".alert-box").remove()},2e3))}}))}),$.ajax({url:"./../php/personal.php",type:"post",data:{username:t},dataType:"json",success:function(e){if($(".user-div-img img,.nav-user img").attr("src","./../src/assets/img/user/"+e.msg.userImg),$(".input-name").val(e.msg.username),$(":radio[name='gender'][value='"+e.msg.gender+"']").attr("checked",!0),$(".input-sign").html(e.msg.Signature),e.answer.length>0)for(var s in e.answer)$(".right-answer").append("<div class='ask-question'><div class='ask-ques-img'><img src='../src/assets/img/user/"+e.answer[s].userImg+"' alt=''> </div> <a href='page-ask-solve.html?id="+e.answer[s].quesId+"'><div class='ask-ques-key'>关键字：<span class='key-value'>"+e.answer[s].keyword+"</span></div><div class='ask-ques-title'><p class='ques-title'>"+e.answer[s].quesTitle+"</p> </div></a><div class='ques-popularity'><h5 class='my-answer'>我的回答</h5><div class='answer-content'>"+e.answer[s].answer+"</div></div></div>");else $(".right-answer").append("<div class='empty'>你还没有回答任何问题哦~</div>");if(e.ask.length>0)for(var a in e.ask)$(".right-ask").append("<div class='ask-question'><div class='ask-ques-img'><img src='../src/assets/img/user/"+e.ask[a].userImg+"' alt=''></div><a href='page-ask-solve.html?id="+e.ask[a].quesId+"'><div class='ask-ques-key'>关键字：<span class='key-value'>"+e.ask[a].keyword+"</span></div><div class='ask-ques-title'><p class='ques-title'>"+e.ask[a].quesTitle+"</p><div class='ques-content'>"+e.ask[a].quesContent+"</div></div></a><div class='ques-popularity'><span>已有 <span class='popularity-num'>"+e.ask[a].ansNum+"</span> 人回答</span></div></div>");else $(".right-ask").append("<div class='empty'>你还没有过提问哦~</div>");if(e.note.length>0)for(var n in e.note)$(".right-note").append("<div class='note-question clearfix'><div class='note-ques-title'><p class='ques-title'><a href='./../web/page-note-show.html?nid="+e.note[n].noteId+"' title='点击查看'>"+e.note[n].noteTitle+"</a><span class='key-value'>"+e.note[n].keyword+"</span><span class='note-user' id='note0'>"+e.note[n].username+"</span></p><div class='ques-content'>"+e.note[n].noteContent+"</div></div><div class='ques-popularity'><span>"+e.note[n].view+" 浏览</span><span> "+e.note[n].noteAdd+" 补充</span></div></div>");else $(".right-note").append("<div class='empty'>你还没有发布过笔记哦~</div>")}}),window.onscroll=function(){if(window.onresize=function(){return $(window).width()},window.onresize()>991){var e=$(document).height(),s=$(document).scrollTop();s<e-900&&$(".personal-left").css("margin-top",s+"px")}else $(".personal-left").css("margin-top","10px")},$(".personal-nav").on("click","li",function(){$(this).children().css("color","#f63"),$(this).siblings().children().css("color","#999")})});